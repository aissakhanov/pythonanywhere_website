<head>
    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
    <style>
        button {
            position: absolute;
            top: 10px;
            left: 10px;
            z-index: 1;
        }
    </style>
</head>
<body>
    <!-- <button onclick="javascript:randomVal();" data-inline="true">randomize</button> -->
    <button onclick="javascript:randomize();" data-inline="true">SORT</button>
    <div id="myDiv"></div>
</body>
<script>
    var n = 10;
    var x = [];
    var y = [];
    var colors = [];
    var ids = [];
    var frame_durations = [];
    var duration_value = 1000;
    function randomVal(){
        y = [];
        for(let k=0; k<n; k++){
            y.push(Math.floor(Math.random() * 100));
        }
        var update = {
            x:[x],
            y:[y],
        }
        Plotly.restyle('myDiv', update);
    }

    function initializeGraph(){
        for(let k=0; k<n; k++){   
            x.push(k+1);
            y.push(Math.floor(Math.random() * 100));
            colors.push('red');
            ids.push(String(k+1));
        }
        var data=[{
            x: x,
            y: y,
            type: 'bar',
            marker:{color: colors},
            ids: ids,
        }];
        var layout = {
            title:'Bubble sort algorithm',
            xaxis:{visible: false}
        };
        var config = {
            responsive: true,
            displayModeBar: false
        }
        Plotly.newPlot('myDiv', data, layout, config);
    }
    initializeGraph();

    var frames = [];
    var colors_cloned = [...colors];
    function sorter(){
        for (let i=0; i<n-1; i++){
            for (let j=0; j < n-i-1; j++){
                colors = [...colors_cloned]
                colors[j] = 'yellow';
                colors[j+1] = 'yellow';
                var temp_frame_1 = {
                    data:[{y:[...y], ids:[...ids], marker: {color: [...colors]}}]
                }
                frames.push(temp_frame_1);
                frame_durations.push({duration: duration_value})
                if (y[j] > y[j+1]) {
                    var temp_id = ids[j];
                    ids[j] = ids[j+1];
                    ids[j+1] = temp_id;                    
                    var temp_y = y[j];
                    y[j] = y[j+1];
                    y[j+1] = temp_y;
                }
                var temp_frame_2 = {
                    data: [{ marker:{color: [...colors]},y:[...y], ids:[...ids], }],
                }
                frames.push(temp_frame_2);
                frame_durations.push({duration: duration_value})
            }
            if (i==n-2){
                colors_cloned[0] = 'green';
            }
            colors_cloned[n-i-1] = 'green';
            var temp_frame_3 = {
                    data:[{y:[...y], ids:[...ids], marker: {color: [...colors_cloned]}}]
                }
            frames.push(temp_frame_3);
            frame_durations.push({duration: duration_value})
        }
    }
    sorter();
    function randomize() {
    Plotly.animate('myDiv', frames, {
        frame: frame_durations,
    //   transition: {
    //     duration: 500,
    //     easing: 'cubic-in-out'
    //   },
    //   frame: {
    //     duration: 50000
    //   },
      mode: 'afterall'
    })
  }
</script>
